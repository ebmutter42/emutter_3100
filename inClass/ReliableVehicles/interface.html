

<!--//filter
//input
//query
//be able to tell how many students are on campus during certain timeframe
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Selector</title>
    <link href="css/lib/bootstrap.min.css" rel="stylesheet">
    <link href="css/lib/bootstrap_theme.min.css" rel="stylesheet">
</head>
<body class="vh-100 bg-dark d-flex text-light">

    <div id="divClassDashboard" class="col-12 mt-5">
        <div class="col-12 justify-content-center align-items-center">
            <div class="card col-12 col-md-10 offset-md-1">
                <div class="card-head">
                    <div class="d-flex col-12 justify-content-between mt-2 ">
                        <h2 style="padding-left:15px;padding-top:5px;">Class Stats</h2>
                    </div>
                </div>
                <div class="card-body">
                    <div></div>
                    <div></div> 
                    <div></div> 
                    <div></div> 
                    <div></div> 
                    <div></div> 
                </div>
            </div>
            <div class="card col-12 col-md-10 offset-md-1 mt-5">
                <div class="card-head">
                    <div class="d-flex col-12 justify-content-between mt-2 ">
                        <h2 style="padding-left:15px;padding-top:5px;">Class Finder</h2>
                    </div>
                </div>
                <div class="card-body">
                    <form>
                        <div class="form-group" id="filterSearch" >
                            <label for="txtTermSearch" class="form-label mt-4">Search Term (required)</label>
                            <input class="form-control" type="text" id="txtTermSearch" placeholder="202280" required>
                            <label for="txtSubjectSearch" class="form-label mt-4">Search Subject</label>
                            <input class="form-control" type="text" id="txtSubjectSearch" placeholder="CSC">
                            <label for="txtMinCapSearch" class="form-label mt-4">Search MinCap</label>
                            <input class="form-control" type="text" id="txtMinCapSearch" placeholder="MinCap">
                            <label for="txtBuildingSearch" class="form-label mt-4">Search Building</label>
                            <input class="form-control" type="text" id="txtBuildingSearch" placeholder="BRUN">
                            <label for="txtRoomSearch" class="form-label mt-4">Search Room</label>
                            <input class="form-control" type="text" id="txtRoomSearch" placeholder="210">
                            <label for="txtCourseSearch" class="form-label mt-4">Search Course</label>
                            <input class="form-control" type="text" id="txtCourseSearch" placeholder="3100">
                            <label for="txtSectionSearch" class="form-label mt-4">Search Section</label>
                            <input class="form-control" type="text" id="txtSectionSearch" placeholder="001">
                            <label for="txtStartSearch" class="form-label mt-4">Search Start Time</label>
                            <input class="form-control" type="time" id="txtStartSearch" placeholder="Start">
                            <label for="txtEndSearch" class="form-label mt-4">Search End Time</label>
                            <input class="form-control" type="time" id="txtEndSearch" placeholder="End">
                        </div>
                        <button class="btn btn-primary mt-2" id="btnSearch" type="button">Find</button>
                        <button class="btn btn-secondary mt-2" id="btnClear" type="button">Clear</button>

                    </form>
                </div>
            </div>
                
            <div class="card col-12 col-md-10 offset-md-1 mt-5">
                    <div class="card-head">
                        <div class="d-flex col-12 justify-content-between mt-2 ">
                            <h2 style="padding-left:15px;padding-top:5px;" id="resultDisplay">Results</h2>
                        </div>
                    </div>
                    <table id="tblClasses" class="table mt-5 text-light">
                        <thead>
                            <tr><th>Department</th><th>Course</th><th>Title</th><th>Location</th><th>Class Days</th><th>Credits</th><th>Student Count</th><th>Time</th><th>Professor</th><th></th></tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
    <script src="js/lib/bootstrap.bundle.min.js"></script>
    <script src="js/lib/sweetalert2@11.js"></script>
    <script>
        //$.getJSON('https://portapi.tntech.edu/express/api/unprotected/getCourseInfoByAPIKey.php',{Key:'5B2FB0FC-79F6-47FF-839D-DA910DD9D17D',Term:'202280'})
        let strURL = "https://portapi.tntech.edu/express/api/unprotected/getCourseInfoByAPIKey.php?Key=5B2FB0FC-79F6-47FF-839D-DA910DD9D17D";
        let portApiUrl = 'https://portapi.tntech.edu/express/api/unprotected/';

        $('#btnSearch').on('click',function(){
            $('#tblClasses tbody').empty();

            let Term = ($('#txtTermSearch').val());
            let Department = $('#txtSubjectSearch').val();
            let MinCap = ($('#txtMinCapSearch').val());
            let Building = ($('#txtBuildingSearch').val());
            let Room = ($('#txtRoomSearch').val());
            let Course = ($('#txtCourseSearch').val());
            let Section = ($('#txtSectionSearch').val());
            let Start = ($('#txtStartSearch').val());
            let End = ($('#txtEndSearch').val());
            let strErrorMessage = '';
            let blnError = false;
            let numResults = 0;
            console.log('Test');
            
            if(Term != ''){
                console.log('Term if Statement procd')
                strURL += "&Term=" + Term;
            } else {
                blnError = true;
                strErrorMessage += "You must include a term in your search.\n"
            }
            if(Department != ''){
                console.log('If Statement procd')
                strURL += "&Subject=" + Department.toUpperCase();
                
            }
            if(MinCap != ''){
                strURL += "&MinCap=" + MinCap;

                
            }
            if(Building != ''){
                strURL += "&Building=" + Building.toUpperCase();

            }if(Room != ''){
                strURL += "&Room=" + Room;

                
            }if(Course != ''){
                strURL += "&Course=" + Course;

                
            }if(Section != ''){
                strURL += "&Section=" + Section;
                
            }


            if(End == '' && Start == ''){
                if(blnError == true){
                    Swal.fire({
                            icon: 'error',
                            title: 'Oh No',
                            text: strErrorMessage
                            })
                }
                else {
                    $.getJSON(strURL,function(courses){
                        $(document).on('click', '.btnDetails', function(){
                            let strCRN = $(this).attr('data-crn');
                            Swal.fire({
                                icon: 'error',
                                title: 'Oh No',
                                text: 'strErrorMessage'
                            })
                        })
                        $.each(courses, function(index,course){
                            numResults += 1; //will be used to display the number of results generated
                            let strRow = '';
                            strRow += '<tr>';

                            if (course.DEPARTMENT != null){
                                strRow += '<td>' + course.DEPARTMENT + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.COURSE != null && course.SECTION != null && course.CRN != null){
                                strRow += '<td>' + course.COURSE + '-' + course.SECTION + ' (' + course.CRN + ')</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.TITLE != null){
                                strRow += '<td>' + course.TITLE + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.BUILDING != null && course.ROOM != null){
                                strRow += '<td>' + course.BUILDING + ' ' + course.ROOM + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }
                                
                            if (course.CLASSDAYS != null){
                                strRow += '<td>' + course.CLASSDAYS + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.CREDITS != null){
                                strRow += '<td>' + course.CREDITS + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.STUDENTCOUNT != null){
                                strRow += '<td>' + course.STUDENTCOUNT + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.STARTTIME != null && course.ENDTIME != null){
                                let startHour = course.STARTTIME[0] + course.STARTTIME[1];
                                startHour = startHour % 12;
                                if (startHour == 0){
                                    startHour = 12;
                                }
                                let startTime = startHour + ':' + course.STARTTIME[2] + course.STARTTIME[3];

                                let endHour = course.ENDTIME[0] + course.ENDTIME[1];
                                endHour = endHour % 12;
                                if (endHour == 0){
                                    endHour = 12;
                                }
                                let endTime = endHour + ':' + course.ENDTIME[2] + course.ENDTIME[3];

                                strRow += '<td>' + startTime + course.STARTAM_PM + '-' + endTime + course.ENDAM_PM + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.PROF != null){
                                strRow += '<td>' + course.PROF + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            strRow += '<td><button class="btn btn-primary btnDetails" type="button" data-crn="' + course.CRN + '">Show Details</button></td>';
                            strRow += '</tr>';
                            $('#tblClasses tbody').append(strRow);
                        })
                    })
                }
                

            } else if(Start != '' && End != ''){
                Start = Start.replace(':','');
                End = End.replace(':','');
                if(blnError == true){
                    Swal.fire({
                            icon: 'error',
                            title: 'Oh No',
                            text: strErrorMessage
                            })
                }
                else {
                    $.getJSON(strURL,function(courses){
                        $(document).on('click', '.btnDetails', function(){
                            let strCRN = $(this).attr('data-crn');
                            Swal.fire({
                                icon: 'error',
                                title: 'Oh No',
                                text: 'strErrorMessage'
                            })
                        })
                        $.each(courses, function(index,course){
                            numResults += 1; //will be used to display the number of results generated
                            let strRow = '';
                            strRow += '<tr>';

                            if (course.DEPARTMENT != null){
                                strRow += '<td>' + course.DEPARTMENT + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.COURSE != null && course.SECTION != null && course.CRN != null){
                                strRow += '<td>' + course.COURSE + '-' + course.SECTION + ' (' + course.CRN + ')</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.TITLE != null){
                                strRow += '<td>' + course.TITLE + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.BUILDING != null && course.ROOM != null){
                                strRow += '<td>' + course.BUILDING + ' ' + course.ROOM + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }
                                
                            if (course.CLASSDAYS != null){
                                strRow += '<td>' + course.CLASSDAYS + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.CREDITS != null){
                                strRow += '<td>' + course.CREDITS + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.STUDENTCOUNT != null){
                                strRow += '<td>' + course.STUDENTCOUNT + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.STARTTIME != null && course.ENDTIME != null){
                                let startHour = course.STARTTIME[0] + course.STARTTIME[1];
                                startHour = startHour % 12;
                                if (startHour == 0){
                                    startHour = 12;
                                }
                                let startTime = startHour + ':' + course.STARTTIME[2] + course.STARTTIME[3];

                                let endHour = course.ENDTIME[0] + course.ENDTIME[1];
                                endHour = endHour % 12;
                                if (endHour == 0){
                                    endHour = 12;
                                }
                                let endTime = endHour + ':' + course.ENDTIME[2] + course.ENDTIME[3];

                                strRow += '<td>' + startTime + course.STARTAM_PM + '-' + endTime + course.ENDAM_PM + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.PROF != null){
                                strRow += '<td>' + course.PROF + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            strRow += '<td><button class="btn btn-primary btnDetails" type="button" data-crn="' + course.CRN + '">Show Details</button></td>';
                            strRow += '</tr>';
                            
                            if(course.STARTTIME == Start && course.ENDTIME == End){
                                $('#tblClasses tbody').append(strRow);
                            }
                        })
                    })
                }
            } else if(Start != ''){
                Start = Start.replace(':','');
                if(blnError == true){
                    Swal.fire({
                            icon: 'error',
                            title: 'Oh No',
                            text: strErrorMessage
                            })
                }
                else {
                    $.getJSON(strURL,function(courses){
                        $(document).on('click', '.btnDetails', function(){
                            let strCRN = $(this).attr('data-crn');
                            Swal.fire({
                                icon: 'error',
                                title: 'Oh No',
                                text: 'strErrorMessage'
                            })
                        })
                        $.each(courses, function(index,course){
                            numResults += 1; //will be used to display the number of results generated
                            let strRow = '';
                            strRow += '<tr>';

                            if (course.DEPARTMENT != null){
                                strRow += '<td>' + course.DEPARTMENT + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.COURSE != null && course.SECTION != null && course.CRN != null){
                                strRow += '<td>' + course.COURSE + '-' + course.SECTION + ' (' + course.CRN + ')</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.TITLE != null){
                                strRow += '<td>' + course.TITLE + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.BUILDING != null && course.ROOM != null){
                                strRow += '<td>' + course.BUILDING + ' ' + course.ROOM + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }
                                
                            if (course.CLASSDAYS != null){
                                strRow += '<td>' + course.CLASSDAYS + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.CREDITS != null){
                                strRow += '<td>' + course.CREDITS + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.STUDENTCOUNT != null){
                                strRow += '<td>' + course.STUDENTCOUNT + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.STARTTIME != null && course.ENDTIME != null){
                                let startHour = course.STARTTIME[0] + course.STARTTIME[1];
                                startHour = startHour % 12;
                                if (startHour == 0){
                                    startHour = 12;
                                }
                                let startTime = startHour + ':' + course.STARTTIME[2] + course.STARTTIME[3];

                                let endHour = course.ENDTIME[0] + course.ENDTIME[1];
                                endHour = endHour % 12;
                                if (endHour == 0){
                                    endHour = 12;
                                }
                                let endTime = endHour + ':' + course.ENDTIME[2] + course.ENDTIME[3];

                                strRow += '<td>' + startTime + course.STARTAM_PM + '-' + endTime + course.ENDAM_PM + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.PROF != null){
                                strRow += '<td>' + course.PROF + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            strRow += '<td><button class="btn btn-primary btnDetails" type="button" data-crn="' + course.CRN + '">Show Details</button></td>';
                            strRow += '</tr>';
                            
                            if(course.STARTTIME == Start){
                                $('#tblClasses tbody').append(strRow);
                            }
                        })
                    })
                }

            } else if(End != ''){
                End = End.replace(':','');
                if(blnError == true){
                    Swal.fire({
                            icon: 'error',
                            title: 'Oh No',
                            text: strErrorMessage
                            })
                }
                else {
                    $.getJSON(strURL,function(courses){
                        $(document).on('click', '.btnDetails', function(){
                            let strCRN = $(this).attr('data-crn');
                            Swal.fire({
                                icon: 'error',
                                title: 'Oh No',
                                text: 'strErrorMessage'
                            })
                        })
                        $.each(courses, function(index,course){
                            numResults += 1; //will be used to display the number of results generated
                            let strRow = '';
                            strRow += '<tr>';

                            if (course.DEPARTMENT != null){
                                strRow += '<td>' + course.DEPARTMENT + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.COURSE != null && course.SECTION != null && course.CRN != null){
                                strRow += '<td>' + course.COURSE + '-' + course.SECTION + ' (' + course.CRN + ')</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.TITLE != null){
                                strRow += '<td>' + course.TITLE + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.BUILDING != null && course.ROOM != null){
                                strRow += '<td>' + course.BUILDING + ' ' + course.ROOM + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }
                                
                            if (course.CLASSDAYS != null){
                                strRow += '<td>' + course.CLASSDAYS + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.CREDITS != null){
                                strRow += '<td>' + course.CREDITS + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.STUDENTCOUNT != null){
                                strRow += '<td>' + course.STUDENTCOUNT + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.STARTTIME != null && course.ENDTIME != null){
                                let startHour = course.STARTTIME[0] + course.STARTTIME[1];
                                startHour = startHour % 12;
                                if (startHour == 0){
                                    startHour = 12;
                                }
                                let startTime = startHour + ':' + course.STARTTIME[2] + course.STARTTIME[3];

                                let endHour = course.ENDTIME[0] + course.ENDTIME[1];
                                endHour = endHour % 12;
                                if (endHour == 0){
                                    endHour = 12;
                                }
                                let endTime = endHour + ':' + course.ENDTIME[2] + course.ENDTIME[3];

                                strRow += '<td>' + startTime + course.STARTAM_PM + '-' + endTime + course.ENDAM_PM + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            if (course.PROF != null){
                                strRow += '<td>' + course.PROF + '</td>';
                            } else {
                                strRow += '<td>N/A</td>';
                            }

                            strRow += '<td><button class="btn btn-primary btnDetails" type="button" data-crn="' + course.CRN + '">Show Details</button></td>';
                            strRow += '</tr>';
                            
                            if(course.ENDTIME == End){
                                $('#tblClasses tbody').append(strRow);
                            }
                        })
                    })
                }
            
            }  

            
                
        })

        $('#btnClear').on('click',function(){
            const inputs = document.querySelectorAll('#txtTermSearch, #txtSubjectSearch, #txtMinCapSearch, #txtBuildingSearch, #txtRoomSearch, #txtCourseSearch, #txtSectionSearch, #txtStartSearch, #txtEndSearch');
            inputs.forEach(input => {
                input.value = '';
            });
        })




    </script>
    
</body>
</html>